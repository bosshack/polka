#!/bin/bash

# ey-db-pull
# =========
#
# Description
# -------------
# This script will pull down a gzipped mysql script from an engine yard database
#
# Usage
# ----------------
# ey-db-pull <ssh_server_name> <engine_yard_application_name> [file_name (default: backup.sql.gz)]
#

server="$1"
app_name="$2"
local_file=$([ -n "$3" ] && echo "$3" || echo "backup.sql.gz")
remote_file="\${HOME}/backup.sql"

ssh -T "$server" <<EOF
/bin/bash -s
mysqldump "$app_name" > "$remote_file"
gzip "$remote_file"
exit 0
EOF

scp "${server}:${remote_file}.gz" "$local_file"
ssh "$server" "rm \"${remote_file}.gz\""

# vim:set ft=sh sts=2 sw=2 ts=2 expandtab noai:
